<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CyberSmrt Blog Post Generator</title>

  <!-- (Optional) Orbitron for headings -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0a0a0a; --bg2:#1a1a2e; --stroke:rgba(255,255,255,.1);
      --fg:#fff; --muted:#b0b0b0; --acc:#667eea; --acc2:#764ba2;
      --panel:rgba(255,255,255,.05);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
      color:var(--fg);
      min-height:100dvh;
    }

    .container{
      max-width:1000px;margin:32px auto;padding:40px;border-radius:20px;
      background:var(--panel);backdrop-filter:blur(10px);
      border:1px solid var(--stroke);
    }
    h1{
      text-align:center;
      font-family:"Orbitron",system-ui,sans-serif;
      font-weight:900; letter-spacing:.02em;
      background:linear-gradient(135deg,var(--acc) 0%,var(--acc2) 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-size:2.4rem; margin-bottom:8px;
    }
    .subtitle{ text-align:center;color:var(--muted);margin-bottom:32px }

    .form-section{
      background:rgba(255,255,255,.03);
      border:1px solid var(--stroke);
      border-radius:15px;padding:24px;margin-bottom:22px;
    }
    .section-title{
      color:var(--acc);font-size:1.2rem;margin-bottom:16px;
      display:flex;gap:10px;align-items:center;
    }
    .form-group{ margin-bottom:16px }
    label{ display:block;color:#d0d0d0;margin-bottom:8px;font-size:.9rem }

    input[type="text"],input[type="date"],input[type="number"],input[type="url"],select,textarea{
      width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.2);
      background:rgba(255,255,255,.05);color:#fff;font-size:1rem;font-family:inherit;
    }
    textarea{ min-height:120px;resize:vertical }
    input:focus,select:focus,textarea:focus{ outline:none;border-color:var(--acc);background:rgba(102,126,234,.1) }

    .toolbar{
      display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px; padding:10px;
      background:rgba(255,255,255,.03); border:1px solid var(--stroke); border-radius:8px;
    }
    .toolbar button,.toolbar select,.toolbar input[type="color"]{
      padding:6px 12px; border-radius:5px; border:1px solid rgba(102,126,234,.3);
      background:rgba(102,126,234,.2); color:#fff; cursor:pointer; font-size:.9rem; transition:.2s;
    }
    .toolbar button:hover{ background:rgba(102,126,234,.4); transform:translateY(-1px) }
    .toolbar select{ min-width:100px }
    .toolbar input[type="color"]{ width:40px;height:30px;padding:2px;cursor:pointer }

    .editor{
      min-height:150px; max-height:400px; overflow:auto; padding:15px;
      border:1px solid rgba(255,255,255,.2); border-radius:8px;
      background:rgba(255,255,255,.05); color:#fff; line-height:1.6;
    }
    .editor:focus{ outline:none;border-color:var(--acc);background:rgba(102,126,234,.1) }
    .editor[contenteditable="true"]:empty:before{ content:attr(data-placeholder); color:#666 }

    .content-section{ background:rgba(59,130,246,.05); border:1px solid rgba(59,130,246,.2); border-radius:12px; padding:20px; margin-bottom:14px }
    .section-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:12px }
    .section-number{
      background:linear-gradient(135deg,var(--acc) 0%,var(--acc2) 100%);
      color:#fff; padding:5px 12px; border-radius:20px; font-size:.9rem; font-weight:600;
    }
    .btn-remove{
      background:rgba(239,68,68,.2); color:#ef4444; border:1px solid rgba(239,68,68,.3);
      padding:6px 12px; border-radius:5px; cursor:pointer; transition:.15s;
    }
    .btn-remove:hover{ background:rgba(239,68,68,.4) }

    .btn{
      padding:12px 20px; border:none; border-radius:8px; font-weight:700; cursor:pointer; transition:.25s;
    }
    .btn-primary{ background:linear-gradient(135deg,var(--acc) 0%,var(--acc2) 100%); color:#fff }
    .btn-primary:hover{ transform:translateY(-2px); box-shadow:0 10px 25px rgba(102,126,234,.4) }
    .btn-secondary{ background:rgba(255,255,255,.1); color:#fff; border:1px solid rgba(255,255,255,.2) }
    .btn-secondary:hover{ background:rgba(255,255,255,.2) }
    .btn-success{ background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff }
    .btn-success:hover{ transform:translateY(-2px); box-shadow:0 10px 25px rgba(16,185,129,.4) }

    .btn-add{
      width:100%; margin-top:12px; padding:14px; font-weight:700;
      background:rgba(102,126,234,.08); border:2px dashed rgba(102,126,234,.35); color:var(--acc);
    }
    .btn-add:hover{ background:rgba(102,126,234,.16); border-color:var(--acc) }

    .media-item{
      background:rgba(255,255,255,.05); border:1px solid var(--stroke); border-radius:8px; padding:15px; margin-bottom:10px;
    }

    .table-preview{ width:100%; border-collapse:collapse; margin-top:10px }
    .table-preview th,.table-preview td{ border:1px solid rgba(255,255,255,.2); padding:10px; text-align:left }
    .table-preview th{ background:rgba(102,126,234,.2); font-weight:600 }
    .table-preview input{ background:transparent; border:none; color:#fff; width:100% }

    .tag-input-container{ display:flex; gap:10px }
    .tag-container{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px }
    .tag{ background:linear-gradient(135deg,var(--acc) 0%,var(--acc2) 100%); color:#fff; padding:6px 12px; border-radius:20px; font-size:.85rem; display:inline-flex; gap:8px; align-items:center }
    .tag-remove{ cursor:pointer; font-weight:900 }

    .actions{ display:flex; gap:12px; justify-content:center; margin-top:24px }
    .success-message{ display:none; background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff; padding:12px; border-radius:8px; margin-top:16px; text-align:center; font-weight:700 }

    /* Preview modal with iframe */
    .preview-modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); z-index:1000; padding:20px }
    .preview-panel{ max-width:1100px; margin:0 auto; height:90dvh; display:grid; grid-template-rows:auto 1fr; gap:10px }
    .close-preview{ justify-self:end; background:#ef4444; color:#fff; border:0; padding:10px 16px; border-radius:8px; cursor:pointer; font-size:1rem }
    .preview-frame{ width:100%; height:100%; border:0; border-radius:10px; background:#fff }

    /* header/footer mounts spacing */
    .admin-wrap{ padding: 16px }
    @media (max-width: 720px){
      .container{ padding:22px }
      h1{ font-size:2rem }
    }
  </style>
</head>

<body>
  <!-- Shared header -->
  <div id="header-mount"></div>
  <script defer src="/assets/js/header-loader.js"></script>
  <script defer src="/assets/js/header-init.js"></script>

  <main class="admin-wrap">
    <div class="container" aria-live="polite">
      <h1>üõ°Ô∏è CyberSmrt Blog Post Generator</h1>
      <p class="subtitle">Create professional blog posts with visual editing</p>

      <!-- Basic Info -->
      <section class="form-section">
        <div class="section-title">üìù Basic Information</div>

        <div class="form-group">
          <label for="postTitle">Post Title *</label>
          <input type="text" id="postTitle" placeholder="Building a K-12 Cybersecurity Curriculum">
        </div>

        <div class="form-group">
          <label for="category">Category *</label>
          <select id="category">
            <option>K-12 Education</option>
            <option>Community Impact</option>
            <option>Cybersecurity Tips</option>
            <option>Workforce Development</option>
            <option>Partner News</option>
          </select>
        </div>

        <div class="form-group">
          <label for="metaDesc">Meta Description (for SEO) *</label>
          <textarea id="metaDesc" placeholder="A brief 150-160 character description for search engines..."></textarea>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="form-group">
            <label for="datePublished">Date Published</label>
            <input type="date" id="datePublished">
          </div>
          <div class="form-group">
            <label for="readTime">Reading Time (minutes)</label>
            <input type="number" id="readTime" value="5" min="1">
          </div>
        </div>
      </section>

      <!-- Author -->
      <section class="form-section">
        <div class="section-title">üë§ Author Information</div>

        <div class="form-group">
          <label for="authorName">Author Name</label>
          <input type="text" id="authorName" value="Tony" placeholder="Tony">
        </div>

        <div class="form-group">
          <label for="authorTitle">Author Title</label>
          <input type="text" id="authorTitle" value="Founder & Executive Director" placeholder="Founder & Executive Director">
        </div>

        <div class="form-group">
          <label for="authorAvatar">Author Avatar Emoji</label>
          <input type="text" id="authorAvatar" value="üë®‚Äçüíª" placeholder="üë®‚Äçüíª">
        </div>
      </section>

      <!-- Opening -->
      <section class="form-section">
        <div class="section-title">üöÄ Opening Hook</div>

        <div class="toolbar">
          <button onclick="formatText('bold','opening')"><strong>B</strong></button>
          <button onclick="formatText('italic','opening')"><em>I</em></button>
          <button onclick="formatText('underline','opening')"><u>U</u></button>
          <button onclick="formatText('insertUnorderedList','opening')">‚Ä¢ List</button>
          <button onclick="formatText('insertOrderedList','opening')">1. List</button>
          <button onclick="formatText('formatBlock','opening','h2')">H2</button>
          <button onclick="formatText('formatBlock','opening','h3')">H3</button>
          <button onclick="formatText('formatBlock','opening','p')">P</button>
          <select onchange="formatText('fontSize','opening',this.value);this.value=''">
            <option value="">Font Size</option><option value="2">Small</option><option value="3">Normal</option><option value="4">Large</option><option value="5">Huge</option>
          </select>
          <input type="color" onchange="formatText('foreColor','opening',this.value)" title="Text Color">
          <input type="color" onchange="formatText('hiliteColor','opening',this.value)" title="Highlight">
          <button onclick="showLinkModal('opening')">üîó Link</button>
          <button onclick="formatText('removeFormat','opening')">‚úï Clear</button>
        </div>

        <div id="opening" class="editor" contenteditable="true" data-placeholder="Start with a compelling hook to grab your readers' attention..."></div>
      </section>

      <!-- Sections -->
      <section class="form-section">
        <div class="section-title">üìÑ Content Sections</div>
        <div id="contentSections"></div>
        <button class="btn btn-add" onclick="addContentSection()">+ Add Content Section</button>
      </section>

      <!-- Media -->
      <section class="form-section">
        <div class="section-title">üì∑ Media (Images & Videos)</div>
        <div id="mediaItems"></div>
        <button class="btn btn-add" onclick="addMediaItem()">+ Add Image or Video</button>
      </section>

      <!-- Tables -->
      <section class="form-section">
        <div class="section-title">üìä Tables</div>
        <div id="tables"></div>
        <div class="table-builder">
          <label>Create New Table:</label>
          <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;margin:10px 0">
            <input type="number" id="tableRows" placeholder="Rows" min="2" value="3">
            <input type="number" id="tableCols" placeholder="Columns" min="2" value="3">
            <button class="btn btn-secondary" onclick="createTable()">Create Table</button>
          </div>
        </div>
      </section>

      <!-- Conclusion -->
      <section class="form-section">
        <div class="section-title">üéØ Conclusion</div>

        <div class="toolbar">
          <button onclick="formatText('bold','conclusion')"><strong>B</strong></button>
          <button onclick="formatText('italic','conclusion')"><em>I</em></button>
          <button onclick="formatText('underline','conclusion')"><u>U</u></button>
          <button onclick="formatText('insertUnorderedList','conclusion')">‚Ä¢ List</button>
          <button onclick="formatText('insertOrderedList','conclusion')">1. List</button>
          <button onclick="formatText('formatBlock','conclusion','h2')">H2</button>
          <button onclick="formatText('formatBlock','conclusion','h3')">H3</button>
          <button onclick="formatText('formatBlock','conclusion','p')">P</button>
          <select onchange="formatText('fontSize','conclusion',this.value);this.value=''">
            <option value="">Font Size</option><option value="2">Small</option><option value="3">Normal</option><option value="4">Large</option><option value="5">Huge</option>
          </select>
          <input type="color" onchange="formatText('foreColor','conclusion',this.value)" title="Text Color">
          <input type="color" onchange="formatText('hiliteColor','conclusion',this.value)" title="Highlight">
          <button onclick="showLinkModal('conclusion')">üîó Link</button>
          <button onclick="formatText('removeFormat','conclusion')">‚úï Clear</button>
        </div>

        <div id="conclusion" class="editor" contenteditable="true" data-placeholder="Wrap up your post with key takeaways and a call to action..."></div>
      </section>

      <!-- Tags -->
      <section class="form-section">
        <div class="section-title">üè∑Ô∏è Tags</div>
        <div class="tag-input-container">
          <input type="text" id="tagInput" placeholder="Add a tag...">
          <button class="btn btn-secondary" onclick="addTag()">Add Tag</button>
        </div>
        <div id="tagContainer" class="tag-container"></div>
      </section>

      <!-- Actions -->
      <div class="actions">
        <button class="btn btn-secondary" onclick="showPreview()">üëÅÔ∏è Preview Post</button>
        <button class="btn btn-primary" onclick="downloadPost()">‚¨áÔ∏è Download HTML</button>
        <button class="btn btn-success" onclick="publishPost()">üöÄ Publish Post</button>
      </div>

      <div id="successMessage" class="success-message">‚úÖ Post published successfully! File saved to downloads.</div>
    </div>
  </main>

  <!-- Preview Modal -->
  <div id="previewModal" class="preview-modal" aria-hidden="true">
    <div class="preview-panel">
      <button class="close-preview" onclick="closePreview()">‚úï Close Preview</button>
      <iframe id="previewFrame" class="preview-frame" title="Post preview"></iframe>
    </div>
  </div>

  <!-- Shared footer -->
  <div id="footer-mount"></div>
  <script defer src="/assets/js/footer-loader.js"></script>

  <script>
    // ---------- State ----------
    let contentSectionCount = 0;
    let mediaItemCount = 0;
    let tableCount = 0;
    let tags = [];
    let currentLinkEditor = '';

    // Default date = today
    (function(){ const d=document.getElementById('datePublished'); if(d) d.valueAsDate=new Date(); })();

    // ---------- Rich text helpers ----------
    function formatText(command, editorId, value=null){
      const editor = document.getElementById(editorId);
      if(!editor) return;
      editor.focus();
      document.execCommand(command, false, value);
    }

    function showLinkModal(editorId){
      currentLinkEditor = editorId;
      const sel = window.getSelection();
      const txt = sel ? sel.toString() : '';
      document.getElementById('linkText').value = txt || '';
      document.getElementById('linkUrl').value = '';
      document.getElementById('linkModal').style.display='block';
      document.getElementById('linkModalBackdrop').style.display='block';
    }
    function closeLinkModal(){
      document.getElementById('linkModal').style.display='none';
      document.getElementById('linkModalBackdrop').style.display='none';
    }
    function insertLink(){
      const linkText = document.getElementById('linkText').value.trim();
      const linkUrl  = document.getElementById('linkUrl').value.trim();
      if(!linkUrl){ alert('Please enter a URL'); return; }
      const editor = document.getElementById(currentLinkEditor);
      if(!editor){ closeLinkModal(); return; }
      editor.focus();
      const html = `<a href="${linkUrl}" target="_blank" rel="noopener noreferrer">${linkText || linkUrl}</a>`;
      document.execCommand('insertHTML', false, html);
      closeLinkModal();
    }

    // ---------- Sections ----------
    function addContentSection(){
      contentSectionCount++;
      const id = contentSectionCount;
      const wrap = document.createElement('div');
      wrap.className='content-section';
      wrap.id = `section-${id}`;
      wrap.innerHTML = `
        <div class="section-header">
          <span class="section-number">Section ${id}</span>
          <button class="btn-remove" onclick="removeSection(${id})">Remove</button>
        </div>
        <div class="form-group">
          <label for="heading-${id}">Section Heading</label>
          <input type="text" id="heading-${id}" placeholder="Section Title">
        </div>
        <div class="toolbar">
          <button onclick="formatText('bold','content-${id}')"><strong>B</strong></button>
          <button onclick="formatText('italic','content-${id}')"><em>I</em></button>
          <button onclick="formatText('underline','content-${id}')"><u>U</u></button>
          <button onclick="formatText('insertUnorderedList','content-${id}')">‚Ä¢ List</button>
          <button onclick="formatText('insertOrderedList','content-${id}')">1. List</button>
          <button onclick="formatText('formatBlock','content-${id}','h3')">H3</button>
          <button onclick="formatText('formatBlock','content-${id}','p')">P</button>
          <select onchange="formatText('fontSize','content-${id}',this.value);this.value=''">
            <option value="">Font Size</option><option value="2">Small</option><option value="3">Normal</option><option value="4">Large</option><option value="5">Huge</option>
          </select>
          <input type="color" onchange="formatText('foreColor','content-${id}',this.value)" title="Text Color">
          <input type="color" onchange="formatText('hiliteColor','content-${id}',this.value)" title="Highlight">
          <button onclick="showLinkModal('content-${id}')">üîó Link</button>
          <button onclick="formatText('removeFormat','content-${id}')">‚úï Clear</button>
        </div>
        <div id="content-${id}" class="editor" contenteditable="true" data-placeholder="Write your content here..."></div>
      `;
      document.getElementById('contentSections').appendChild(wrap);
    }
    function removeSection(id){ const el=document.getElementById(`section-${id}`); if(el) el.remove(); }

    // ---------- Media ----------
    function addMediaItem(){
      mediaItemCount++;
      const id = mediaItemCount;
      const item = document.createElement('div');
      item.className='media-item';
      item.id = `media-${id}`;
      item.innerHTML = `
        <div class="section-header">
          <span class="section-number">Media ${id}</span>
          <button class="btn-remove" onclick="removeMedia(${id})">Remove</button>
        </div>
        <div class="form-group">
          <label for="mediaType-${id}">Media Type</label>
          <select id="mediaType-${id}" onchange="updateMediaFields(${id})">
            <option value="image">Image</option>
            <option value="video">Video (YouTube)</option>
          </select>
        </div>
        <div class="form-group">
          <label id="mediaUrlLabel-${id}" for="mediaUrl-${id}">Image URL</label>
          <input type="url" id="mediaUrl-${id}" placeholder="https://example.com/image.jpg">
        </div>
        <div class="form-group">
          <label for="mediaCaption-${id}">Caption</label>
          <input type="text" id="mediaCaption-${id}" placeholder="Image description...">
        </div>
      `;
      document.getElementById('mediaItems').appendChild(item);
    }
    function updateMediaFields(id){
      const type = document.getElementById(`mediaType-${id}`).value;
      const label = document.getElementById(`mediaUrlLabel-${id}`);
      const input = document.getElementById(`mediaUrl-${id}`);
      if(type==='video'){ label.textContent='YouTube Video ID'; input.placeholder='e.g., dQw4w9WgXcQ'; }
      else{ label.textContent='Image URL'; input.placeholder='https://example.com/image.jpg'; }
    }
    function removeMedia(id){ const el=document.getElementById(`media-${id}`); if(el) el.remove(); }

    // ---------- Tables ----------
    function createTable(){
      const rows = parseInt(document.getElementById('tableRows').value,10);
      const cols = parseInt(document.getElementById('tableCols').value,10);
      if(rows<2 || cols<2){ alert('Table must have at least 2 rows and 2 columns'); return; }
      tableCount++;
      const id = tableCount;
      const wrap = document.createElement('div');
      wrap.className='media-item';
      wrap.id=`table-${id}`;
      let html = `
        <div class="section-header">
          <span class="section-number">Table ${id}</span>
          <button class="btn-remove" onclick="removeTable(${id})">Remove</button>
        </div>
        <table class="table-preview" id="tableData-${id}">
          <thead><tr>`;
      for(let c=0;c<cols;c++) html += `<th><input type="text" placeholder="Header ${c+1}"></th>`;
      html += `</tr></thead><tbody>`;
      for(let r=1;r<rows;r++){
        html += '<tr>';
        for(let c=0;c<cols;c++) html += `<td><input type="text" placeholder="Data"></td>`;
        html += '</tr>';
      }
      html += `</tbody></table>`;
      wrap.innerHTML = html;
      document.getElementById('tables').appendChild(wrap);
    }
    function removeTable(id){ const el=document.getElementById(`table-${id}`); if(el) el.remove(); }

    // ---------- Tags ----------
    function addTag(){
      const input = document.getElementById('tagInput');
      const tag = (input.value||'').trim();
      if(tag && !tags.includes(tag)){ tags.push(tag); updateTagDisplay(); input.value=''; }
    }
    function removeTag(tag){ tags = tags.filter(t=>t!==tag); updateTagDisplay(); }
    function updateTagDisplay(){
      const container = document.getElementById('tagContainer');
      container.innerHTML = tags.map(t => `<span class="tag">${t}<span class="tag-remove" onclick="removeTag('${t}')">√ó</span></span>`).join('');
    }
    document.getElementById('tagInput').addEventListener('keypress', e=>{
      if(e.key==='Enter'){ addTag(); e.preventDefault(); }
    });

    // Seed with one content section
    addContentSection();

    // ---------- HTML Generation (Post) ----------
    function generatePostHTML(){
      const title = document.getElementById('postTitle').value || 'Untitled Post';
      const category = document.getElementById('category').value;
      const metaDesc = (document.getElementById('metaDesc').value || '').replace(/"/g,'&quot;');
      const date = document.getElementById('datePublished').value || new Date().toISOString().slice(0,10);
      const readTime = document.getElementById('readTime').value || '5';
      const authorName = document.getElementById('authorName').value || 'CyberSmrt';
      const authorTitle = document.getElementById('authorTitle').value || '';
      const authorAvatar = document.getElementById('authorAvatar').value || 'üõ°Ô∏è';
      const opening = document.getElementById('opening').innerHTML;
      const conclusion = document.getElementById('conclusion').innerHTML;

      // Build sections
      let contentHTML = '';
      for(let i=1;i<=contentSectionCount;i++){
        const heading = document.getElementById(`heading-${i}`);
        const content = document.getElementById(`content-${i}`);
        if(heading && content){
          const h = (heading.value || '').trim();
          if(h) contentHTML += `<h2>${h}</h2>`;
          contentHTML += `<div class="section-content">${content.innerHTML}</div>`;
        }
      }

      // Media
      let mediaHTML = '';
      for(let i=1;i<=mediaItemCount;i++){
        const type = document.getElementById(`mediaType-${i}`);
        const url  = document.getElementById(`mediaUrl-${i}`);
        const cap  = document.getElementById(`mediaCaption-${i}`);
        if(type && url && url.value){
          if(type.value==='video'){
            mediaHTML += `
              <div class="video-container">
                <iframe width="100%" height="400" src="https://www.youtube.com/embed/${url.value}" frameborder="0" allowfullscreen loading="lazy"></iframe>
                ${cap.value ? `<p class="caption">${cap.value}</p>` : ''}
              </div>`;
          } else {
            mediaHTML += `
              <div class="image-container">
                <img src="${url.value}" alt="${(cap.value||'Blog image').replace(/"/g,'&quot;')}" loading="lazy"/>
                ${cap.value ? `<p class="caption">${cap.value}</p>` : ''}
              </div>`;
          }
        }
      }

      // Tables (convert inputs to text)
      let tablesHTML = '';
      for(let i=1;i<=tableCount;i++){
        const tableElem = document.getElementById(`tableData-${i}`);
        if(tableElem){
          const cloned = tableElem.cloneNode(true);
          cloned.querySelectorAll('input').forEach(inp=>{
            const text = document.createTextNode(inp.value || '');
            inp.parentNode.replaceChild(text, inp);
          });
          tablesHTML += `<div class="table-container">${cloned.outerHTML}</div>`;
        }
      }

      const tagsHTML = tags.map(t=>`<span class="tag">${t}</span>`).join('');
      const displayDate = new Date(date).toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'});

      // Final post HTML (loads shared header/footer) + share-link runtime patch
      return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="${metaDesc}">
  <title>${title} - CyberSmrt Blog</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{ --fg:#fff; --muted:#b0b0b0; --acc:#667eea; --acc2:#764ba2; --stroke:rgba(255,255,255,.1) }
    *{margin:0;padding:0;box-sizing:border-box}
    body{ font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background:linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 100%); color:var(--fg); line-height:1.7 }
    main{ max-width:900px; margin:60px auto; padding:0 20px }
    article{ background:rgba(255,255,255,.05); border:1px solid var(--stroke); border-radius:20px; backdrop-filter:blur(10px); padding:40px }
    .category{ display:inline-block; background:linear-gradient(135deg,var(--acc),var(--acc2)); color:#fff; padding:6px 16px; border-radius:20px; font-size:.85rem; font-weight:600; margin-bottom:18px }
    h1{ font-size:2.4rem; line-height:1.2; margin-bottom:12px }
    .post-meta{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; color:var(--muted); font-size:.95rem; margin-bottom:24px }
    .author{ display:flex; gap:10px; align-items:center }
    .author-avatar{ font-size:2rem }
    .content h2{ color:var(--acc); font-size:1.6rem; margin:32px 0 14px }
    .content h3{ font-size:1.25rem; margin:22px 0 10px }
    .content p{ margin-bottom:16px; font-size:1.05rem }
    .content ul,.content ol{ padding-left:24px; margin-bottom:16px }
    .image-container,.video-container,.table-container{ margin:24px 0 }
    .image-container img{ width:100%; border-radius:12px }
    .video-container iframe{ border-radius:12px }
    .caption{ text-align:center; color:var(--muted); font-size:.9rem; margin-top:8px }
    table{ width:100%; border-collapse:collapse; margin:16px 0 }
    th,td{ border:1px solid rgba(255,255,255,.2); padding:12px; text-align:left }
    th{ background:rgba(102,126,234,.2) }
    .tags{ display:flex; gap:10px; flex-wrap:wrap; margin:26px 0; padding-top:20px; border-top:1px solid var(--stroke) }
    .tag{ background:linear-gradient(135deg,var(--acc),var(--acc2)); color:#fff; padding:6px 14px; border-radius:20px; font-size:.85rem }
    .share-buttons{ display:flex; gap:12px; flex-wrap:wrap; margin-top:20px }
    .share-btn{ padding:12px 20px; border:1px solid var(--stroke); border-radius:8px; background:rgba(255,255,255,.05); color:#fff; text-decoration:none }
    .share-btn:hover{ background:rgba(102,126,234,.2); border-color:var(--acc) }
  </style>
</head>
<body>
  <!-- Shared header -->
  <div id="header-mount"></div>
  <script defer src="/assets/js/header-loader.js"></script>
  <script defer src="/assets/js/header-init.js"></script>

  <main>
    <article>
      <span class="category">${category}</span>
      <h1>${title}</h1>

      <div class="post-meta">
        <div class="author">
          <span class="author-avatar">${authorAvatar}</span>
          <div>
            <div><strong>${authorName}</strong></div>
            <div>${authorTitle}</div>
          </div>
        </div>
        <span>‚Ä¢</span>
        <span>${displayDate}</span>
        <span>‚Ä¢</span>
        <span>${readTime} min read</span>
      </div>

      <div class="content">
        ${opening}
        ${contentHTML}
        ${mediaHTML}
        ${tablesHTML}
        ${conclusion}
      </div>

      ${tags.length ? `<div class="tags">${tagsHTML}</div>` : ''}

      <div class="share-buttons">
        <a class="share-btn" data-share="x"        href="#" target="_blank" rel="noopener">Share on X</a>
        <a class="share-btn" data-share="linkedin" href="#" target="_blank" rel="noopener">Share on LinkedIn</a>
        <a class="share-btn" data-share="email"    href="#">Share via Email</a>
      </div>
    </article>
  </main>

  <!-- Shared footer -->
  <div id="footer-mount"></div>
  <script defer src="/assets/js/footer-loader.js"></script>

  <!-- Fill share URLs at runtime -->
  <script>
    (function () {
      var pageUrl   = encodeURIComponent(window.location.href);
      var pageTitle = encodeURIComponent(document.title.replace(' - CyberSmrt Blog',''));

      var x = document.querySelector('[data-share="x"]');
      if (x) x.href = 'https://twitter.com/intent/tweet?text=' + pageTitle + '&url=' + pageUrl;

      var li = document.querySelector('[data-share="linkedin"]');
      if (li) li.href = 'https://www.linkedin.com/sharing/share-offsite/?url=' + pageUrl;

      var em = document.querySelector('[data-share="email"]');
      if (em) em.href = 'mailto:?subject=' + pageTitle + '&body=Check out this article: ' + pageUrl;
    })();
  <\/script>
</body>
</html>`;
    }

    // ---------- Preview / Download / Publish ----------
    function showPreview(){
      const html = generatePostHTML();
      const iframe = document.getElementById('previewFrame');
      iframe.srcdoc = html;
      document.getElementById('previewModal').style.display='block';
      document.getElementById('previewModal').setAttribute('aria-hidden','false');
    }
    function closePreview(){
      const modal = document.getElementById('previewModal');
      modal.style.display='none';
      modal.setAttribute('aria-hidden','true');
      const iframe = document.getElementById('previewFrame');
      iframe.srcdoc = '';
    }
    function downloadPost(){
      const title = document.getElementById('postTitle').value.trim();
      if(!title){ alert('Please enter a post title first!'); return; }
      const html = generatePostHTML();
      const filename = title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'') + '.html';
      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download=filename; a.click();
      URL.revokeObjectURL(url);
    }
    function publishPost(){
      const title = document.getElementById('postTitle').value.trim();
      if(!title){ alert('Please enter a post title first!'); return; }
      downloadPost();
      const msg = document.getElementById('successMessage');
      msg.style.display='block';
      setTimeout(()=>{ msg.style.display='none'; }, 5000);
    }
  </script>

  <!-- Link Modal -->
  <div id="linkModalBackdrop" class="preview-modal" style="display:none;background:rgba(0,0,0,.7);z-index:1999"></div>
  <div id="linkModal" class="preview-modal" style="display:none;z-index:2000;align-items:center;justify-content:center;padding:0">
    <div style="background:#1a1a2e;border:1px solid rgba(255,255,255,.2);border-radius:12px;min-width:360px;padding:20px">
      <h3 style="margin-bottom: 14px;">Insert Link</h3>
      <div class="form-group">
        <label>Link Text</label>
        <input type="text" id="linkText" placeholder="Click here">
      </div>
      <div class="form-group">
        <label>URL</label>
        <input type="url" id="linkUrl" placeholder="https://example.com">
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top: 14px;">
        <button class="btn btn-secondary" onclick="closeLinkModal()">Cancel</button>
        <button class="btn btn-primary" onclick="insertLink()">Insert Link</button>
      </div>
    </div>
  </div>

  <script>
    // Close link modal when backdrop clicked
    document.getElementById('linkModalBackdrop').addEventListener('click', closeLinkModal);
  </script>
</body>
</html>
